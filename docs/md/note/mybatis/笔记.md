# 实际开发可copy
## 配置文件
```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!--对应的接口mapper-->
<mapper namespace="com.meituan.ai.sco.pallas.dal.mapper.CityAnalyseMapper">
<!--对应的结果类-->
  <resultMap id="ResultMap" type="com.meituan.ai.sco.pallas.model.stastics.AggregateCityResult">
      <result column="city" jdbcType="VARCHAR" property="city" />
      <result column="call_count" jdbcType="INTEGER" property="callCount" />
      <result column="through_rate" jdbcType="FLOAT" property="throughRate" />
      <result column="first_round_not_hangup_rate" jdbcType="FLOAT" property="firstRoundNotHangupRate" />
      <result column="cooperate_rate" jdbcType="FLOAT" property="cooperateRate" />
      <result column="success_rate" jdbcType="FLOAT" property="successRate" />
      <result column="success_after_cooperate_rate" jdbcType="FLOAT" property="successAfterCooperateRate" />
      <result column="antipathy_rate" jdbcType="FLOAT" property="antipathyRate" />
      <result column="talking_time_len" jdbcType="FLOAT" property="talkingTimeLen" />
  </resultMap>
    
    <select id="selectAllByCallDateAndTemplate" resultMap="ResultMap">
        <include refid="cityData"/>
    </select>
    
    <select id="selectByCallDateAndTemplate" resultMap="ResultMap">
        <include refid="cityData"/>
        <if test="sortClause != null">
            order by ${sortClause}
        </if>
    </select>
    
    <sql id="cityData">
        select city,
        sum(total_count) as call_count,
        sum(through_count)/sum(total_count) as through_rate,
        sum(first_round_not_hangup_count)/sum(through_count) as first_round_not_hangup_rate,
        sum(cooperate_count)/sum(through_count) as cooperate_rate,
        sum(success_count)/sum(through_count) as success_rate,
        sum(success_count)/sum(cooperate_count) as success_after_cooperate_rate,
        sum(antipathy_count)/sum(through_count) as antipathy_rate,
        sum(talking_time_len)/1000 as talking_time_len
        from ai_sco_day_city_analyse
        <where>
            <trim prefixOverrides="and">
                <if test="startDate != null">
                    and call_date &gt;= #{startDate}
                </if>
                <if test="endDate != null">
                    and call_date &lt;= #{endDate}
                </if>
                <if test="templateId != null">
                    and template_id = #{templateId}
                </if>
                <if test="templateVersion != null">
                    and template_version = #{templateVersion}
                </if>
            </trim>
        </where>
        group by city
    </sql>

    <foreach collection="list" item="item" index="index" separator=",">
        (#{item.taskId},#{item.callDetail})
    </foreach>
</mapper>
```

## 分页

```java
public PageInfo<KnowledgeVO> selectByDateAndTemplate() {
        PageHelper.startPage(currentPage,pageSize);
        List<AggregateKnowledgeResult> res = knowledgeMapper.selectByDateAndTemplate();
        PageInfo pageAggregateKnowledgeResults = new PageInfo(res);
        final List<KnowledgeVO> knowledgeVOS = new ArrayList<>();
        res.forEach(data->{
            KnowledgeVO knowledgeVO=new KnowledgeVO();
            //VO匹配
            knowledgeVOS.add(knowledgeVO);
        });
  			//重设list
        pageAggregateKnowledgeResults.setList(knowledgeVOS);
        return pageAggregateKnowledgeResults;
    }
```

