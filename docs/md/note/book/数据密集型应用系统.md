# 第一章 可靠、可扩展与可维护的应用系统

## 描述负载

一个推特的系统（2011年12月），主要做两件事

- 发布tweet消息，平均4.6kQPS,峰值12KQPS
- 主页时间线浏览，平均300k QPS

每个用户会关注很多人，也会被很多人关注，大概有两种解决方案：

1. 用户将推特消息插入消息表，浏览时间线时先查询关注的人根据人取出所有的消息、关注人信息，然后按照时间排序
2. 给每个用户维护一个缓存，当他的关注人发推特时查询他的关注者，然后将消息投递出去

推特使用了第2种方法，由于浏览压力比发布高出两个数量级，基于此在发布时多做一些事情可以加速读性能，但是方法2的缺点也很明显，一是写缓存压力巨大尤其是对于有几亿粉丝的用户。最后推特选择了两种方案的结合，超多关注者采用方法1，关注少的采用2。

## 描述性能

- 负载增加以后，系统资源不变，系统性能会发生什么变化
- 负载增加如果要保持性能不变，需要增加多少资源

# 第二章 数据模型与查询语言

## 关系型数据库与文档型数据库

以简历为例，存到关系型数据库需要多张表：地址表、教育经历表、联系表等等，使用时还需要拼接起来，要拿到用户的信息需要多次查询，但是在文档型数据库中可以以json的格式直接全部存起来。

## 图状数据模型

有顶点与边，顶点表示相同类型的事物（人、网页、交叉路口等），边表示了顶点的关系

# 第三章 数据存储与检索

## 事务处理系统与分析系统

处理一般在线，数据量少，相应时间要求高（GB到TB），分析一般离线，批量导入，数据量大（TB到PB）

## 星型与雪花型分析模式

在分析中，维度单独建表，事实表通过键关联到维度，这就是星型，比如通话表有租户、机器人，机器人等单独各是一个维度表。

维度通常表示事件的who、what、where、when、how、why

这个模式的一个变种称为雪花模式，维度可以进一步细分为子空间。这种模式更加规范化，但是星型通常是首选，典型的数仓中表很宽，有时候有几百列、维度表也可能非常宽。

## 列式存储

典型的分析中，可能只会分析100列中的4,5列，多数OLTP存储面向行，但是OLAP分析系统更适合列存储，容易压缩

Hbase等有一个列族的概念，在列族中他将每一行的所有列与行主键一起保存并且不使用列压缩

## OTTP流派

- 日志结构流派，只允许追加更新和删除过时文件，但不会修改已写入的文件，比如Cassandra、Hbase
- 原地更新流派，将磁盘视为可以覆盖的一组大小固定的页，B-tree是典型代表

# 第四章 数据编码与演化

## JSON、XML、CSV与二进制

- XML、CSV无法区分数字和由数字组成的字符串，JSON可以区分但是没法区分整数和浮点数
- json、XML没法区分二进制（图片、字节流）数据，可以用Base64转码，但是有点混乱并且数据大小增加了33%

## Thrift、Protocol Buffers

都需要模式来编码任意的数据

## Avro

Thrift不适合Hadoop，它有两种模式语言，一种用于人工编辑（基于IDl），另一种易于机器阅读（基于json）

# 第五章 数据复制

# 第六章 数据分区

